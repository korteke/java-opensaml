<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd">

    <context:property-placeholder />

    <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
        <property name="persistenceUnitName" value="unit-tests" />
        <property name="packagesToScan" value="org.opensaml.storage.impl" />
        <!-- non jta datasource is resource_local -->
        <property name="dataSource" ref="dataSource" />
        <property name="jpaVendorAdapter" ref="jpaVendorAdapter" />
        <property name="jpaDialect">
            <bean class="org.springframework.orm.jpa.vendor.HibernateJpaDialect" />
        </property>
    </bean>
 
    <!-- Run test with -DdbType=<hibernate|mysql|postgres> to activate various beans -->
    <alias name="${dbType:hibernate}JpaVendorAdapter" alias="jpaVendorAdapter" />
    <alias name="${dbType:hibernate}DataSource" alias="dataSource" />

    <!--  Hypersonic configuration -->
    <bean id="hibernateJpaVendorAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
        <property name="database" value="HSQL" />
        <property name="generateDdl" value="true" />
        <property name="showSql" value="false"/>
    </bean> 
    <bean id="hibernateDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close" lazy-init="true"
        p:driverClass="org.hsqldb.jdbcDriver"
        p:jdbcUrl="jdbc:hsqldb:mem:JPAStorageService" p:user="SA" p:password="" p:acquireIncrement="3"
        p:acquireRetryAttempts="24" p:acquireRetryDelay="5000" p:breakAfterAcquireFailure="true" p:minPoolSize="1"
        p:maxPoolSize="5" p:maxIdleTime="300" p:idleConnectionTestPeriod="360" />

    <!-- Postgres configuration -->
    <bean id="postgresJpaVendorAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
        <property name="database" value="POSTGRESQL" />
        <property name="generateDdl" value="true" />
    </bean> 
    <bean id="postgresDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close" lazy-init="true"
        p:driverClass="org.postgresql.Driver"
        p:jdbcUrl="jdbc:postgresql://localhost:5432/storageservice" p:user="shib" p:password="p@ssw0rd" p:acquireIncrement="3"
        p:acquireRetryAttempts="24" p:acquireRetryDelay="5000" p:breakAfterAcquireFailure="true" p:minPoolSize="1"
        p:maxPoolSize="5" p:maxIdleTime="300" p:idleConnectionTestPeriod="360" />

    <!-- MySQL configuration -->
    <bean id="mysqlJpaVendorAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
        <property name="database" value="MYSQL" />
        <property name="databasePlatform" value="org.hibernate.dialect.MySQLDialect" />
        <property name="generateDdl" value="true" />
    </bean>
    <bean id="mysqlDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close" lazy-init="true"
        p:driverClass="com.mysql.jdbc.Driver"
        p:jdbcUrl="jdbc:mysql://localhost:3306/storageservice" p:user="shib" p:password="p@ssw0rd" p:acquireIncrement="3"
        p:acquireRetryAttempts="24" p:acquireRetryDelay="5000" p:breakAfterAcquireFailure="true" p:minPoolSize="1"
        p:maxPoolSize="5" p:maxIdleTime="300" p:idleConnectionTestPeriod="360" />

    <!-- Oracle configuration
    
        Add this dependency to your pom
        <dependency>
            <groupId>com.oracle</groupId>
            <artifactId>jdbc</artifactId>
            <version>12.1.0.1</version>
        </dependency>
    -->
    
    <bean id="oracleJpaVendorAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
        <property name="database" value="ORACLE" />
        <property name="databasePlatform" value="org.hibernate.dialect.OracleDialect" />
        <property name="generateDdl" value="true" />
    </bean> 
    <bean id="oracleDataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource" destroy-method="close" lazy-init="true"
        p:driverClass="oracle.jdbc.OracleDriver"
        p:jdbcUrl="jdbc:oracle:thin:@//localhost:1521/PDB1" p:user="pmuser" p:password="oracle" p:acquireIncrement="3"
        p:acquireRetryAttempts="24" p:acquireRetryDelay="5000" p:breakAfterAcquireFailure="true" p:minPoolSize="1"
        p:maxPoolSize="5" p:maxIdleTime="300" p:idleConnectionTestPeriod="360" />
    
</beans>